<!DOCTYPE html>
<html>
<head>
<title>Night Runner</title>
</head>
<body style="margin:0;overflow:hidden;background:#222;">

<h3 id="info" style="color:white;text-align:center;">Day Time - Collect Coins</h3>

<canvas id="game" width="800" height="400" style="background:#7ec850;display:block;margin:auto;"></canvas>

<canvas id="joy" width="200" height="200" style="position:fixed;bottom:10px;left:10px;"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const info = document.getElementById("info");

const joy = document.getElementById("joy");
const jctx = joy.getContext("2d");

let player={x:50,y:200,size:20,speed:3};
let coins=[], monsters=[];
let day=true, time=0, score=0;

// joystick
let joyX=100, joyY=100, touch=false;

for(let i=0;i<5;i++) coins.push({x:Math.random()*760,y:Math.random()*360});

joy.addEventListener("touchstart",e=>{touch=true;});
joy.addEventListener("touchend",e=>{touch=false; joyX=100; joyY=100;});
joy.addEventListener("touchmove",e=>{
  let rect=joy.getBoundingClientRect();
  joyX=e.touches[0].clientX-rect.left;
  joyY=e.touches[0].clientY-rect.top;
});

function drawJoy(){
  jctx.clearRect(0,0,200,200);
  jctx.beginPath();
  jctx.arc(100,100,50,0,Math.PI*2);
  jctx.strokeStyle="white";
  jctx.stroke();

  jctx.beginPath();
  jctx.arc(joyX,joyY,20,0,Math.PI*2);
  jctx.fillStyle="white";
  jctx.fill();
}

function spawnMonster(){
  monsters.push({x:800,y:Math.random()*360,size:20});
}

function loop(){
  ctx.clearRect(0,0,800,400);
  drawJoy();

  // move by joystick
  let dx=joyX-100;
  let dy=joyY-100;
  player.x += dx*0.05;
  player.y += dy*0.05;

  time++;
  if(time>600){
    day=!day; time=0;
    if(day){
      info.innerText="Day Time - Collect Coins";
      monsters=[];
      canvas.style.background="#7ec850";
    }else{
      info.innerText="Night Time - Survive!";
      canvas.style.background="#111";
      spawnMonster();
    }
  }

  // Player
  ctx.fillStyle="cyan";
  ctx.fillRect(player.x,player.y,20,20);

  // Coins
  if(day){
    ctx.fillStyle="gold";
    for(let c of coins){
      ctx.fillRect(c.x,c.y,10,10);
      if(Math.abs(player.x-c.x)<20 && Math.abs(player.y-c.y)<20){
        c.x=Math.random()*760;
        c.y=Math.random()*360;
        score++;
      }
    }
  }

  // Monsters
  if(!day){
    ctx.fillStyle="red";
    for(let m of monsters){
      m.x-=2;
      ctx.fillRect(m.x,m.y,20,20);
      if(Math.abs(player.x-m.x)<20 && Math.abs(player.y-m.y)<20){
        alert("Game Over! Score: "+score);
        location.reload();
      }
    }
    if(time%120==0) spawnMonster();
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
